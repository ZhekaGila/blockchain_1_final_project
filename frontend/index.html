<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>AchievementChain ‚Äî NFT Portfolio (Frontend)</title>
  <script src="https://cdn.jsdelivr.net/npm/ethers@6.13.2/dist/ethers.umd.min.js"></script>

  <style>
    :root{
      --bg:#0b1020;
      --panel:rgba(255,255,255,.06);
      --text:#eaf0ff;
      --muted:rgba(234,240,255,.65);
      --line:rgba(255,255,255,.12);
      --accent:#7c5cff;
      --ok:#36d399;
      --bad:#fb7185;
      --warn:#fbbf24;
      --shadow:0 10px 30px rgba(0,0,0,.35);
      --r:18px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      color:var(--text);
      background:
        radial-gradient(900px 600px at 20% 10%, rgba(124,92,255,.35), transparent 60%),
        radial-gradient(900px 600px at 80% 40%, rgba(54,211,153,.18), transparent 55%),
        radial-gradient(900px 600px at 40% 90%, rgba(251,191,36,.10), transparent 55%),
        var(--bg);
      min-height:100vh;
    }
    .container{max-width:1140px;margin:0 auto;padding:18px}
    .card{
      background:linear-gradient(180deg, var(--panel), rgba(255,255,255,.04));
      border:1px solid var(--line);
      border-radius:var(--r);
      box-shadow:var(--shadow);
      backdrop-filter: blur(10px);
    }
    a{color:inherit;text-decoration:none}
    button{
      cursor:pointer;
      border:1px solid rgba(255,255,255,.14);
      background:rgba(255,255,255,.06);
      color:var(--text);
      padding:10px 12px;
      border-radius:14px;
      font-weight:700;
      transition:.15s transform,.15s background;
    }
    button:hover{transform:translateY(-1px);background:rgba(255,255,255,.08)}
    .btnPrimary{
      background:linear-gradient(135deg, rgba(124,92,255,1), rgba(124,92,255,.65));
      border-color:rgba(124,92,255,.85);
    }
    .btnDanger{background:rgba(251,113,133,.14);border-color:rgba(251,113,133,.35)}
    .btnOk{background:rgba(54,211,153,.14);border-color:rgba(54,211,153,.35)}

    .shell{display:grid;grid-template-columns:280px 1fr;gap:14px}
    @media (max-width: 980px){.shell{grid-template-columns:1fr}}
    .sidebar{padding:14px}
    .content{padding:14px}
    .logo{display:flex;align-items:center;gap:10px;font-weight:900}
    .dotLogo{
      width:34px;height:34px;border-radius:12px;
      background:linear-gradient(135deg, rgba(124,92,255,1), rgba(54,211,153,1));
      box-shadow:0 12px 30px rgba(124,92,255,.22);
    }
    .nav{display:flex;flex-direction:column;gap:8px;margin-top:12px}
    .nav a{
      padding:10px 12px;border-radius:14px;
      color:var(--muted);
      border:1px solid transparent;
    }
    .nav a.active{
      color:var(--text);
      background:rgba(124,92,255,.14);
      border-color:rgba(124,92,255,.35);
    }
    .nav a:hover{background:rgba(255,255,255,.05);color:var(--text)}
    .small{font-size:12px;color:var(--muted)}
    .topbar{display:flex;align-items:center;justify-content:space-between;gap:10px;margin-bottom:12px;flex-wrap:wrap}
    .title{margin:0;font-weight:900;font-size:18px}
    .sub{margin:0;color:var(--muted);font-size:12px}
    .pill{
      font-size:12px;color:var(--muted);
      padding:7px 10px;border-radius:999px;border:1px solid var(--line);
      background:rgba(255,255,255,.03);
      display:flex;gap:8px;align-items:center;
    }
    .dot{width:8px;height:8px;border-radius:99px;background:var(--warn)}
    .dot.ok{background:var(--ok)}
    .dot.bad{background:var(--bad)}
    .mono{font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace}

    .table{
      width:100%;
      border-collapse:separate;
      border-spacing:0;
      overflow:hidden;
      border-radius:16px;
      border:1px solid var(--line);
      background:rgba(255,255,255,.02);
    }
    .table th,.table td{
      padding:10px 10px;
      border-bottom:1px solid rgba(255,255,255,.08);
      text-align:left;
      font-size:13px;
      vertical-align:top;
    }
    .table th{color:var(--muted);font-weight:800;background:rgba(255,255,255,.03)}
    .table tr:last-child td{border-bottom:none}
    .tag{
      font-size:12px;
      padding:5px 8px;
      border-radius:999px;
      border:1px solid var(--line);
      background:rgba(255,255,255,.03);
      color:var(--muted);
      display:inline-flex;gap:6px;align-items:center;
      margin:2px 4px 2px 0;
      white-space:nowrap;
    }
    .tag.ok{border-color:rgba(54,211,153,.35);background:rgba(54,211,153,.10);color:rgba(234,240,255,.95)}
    .tag.warn{border-color:rgba(251,191,36,.35);background:rgba(251,191,36,.10);color:rgba(234,240,255,.95)}
    .tag.bad{border-color:rgba(251,113,133,.35);background:rgba(251,113,133,.10);color:rgba(234,240,255,.95)}

    .grid{display:grid;grid-template-columns:repeat(12,1fr);gap:12px}
    .col12{grid-column:span 12}
    .col7{grid-column:span 7}
    .col5{grid-column:span 5}
    @media (max-width: 980px){.col7,.col5{grid-column:span 12}}
    .block{padding:14px}
    .h2{font-size:14px;font-weight:900;margin:0 0 8px}
    .muted{color:var(--muted);font-size:13px;line-height:1.6}
    .rowBtns{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px}
    .bar{
      height:10px;border-radius:999px;border:1px solid var(--line);
      background:rgba(255,255,255,.03);
      overflow:hidden;
    }
    .bar > div{height:100%;background:rgba(124,92,255,.75);width:0%}
    .toast{
      position:fixed;left:50%;bottom:18px;transform:translateX(-50%);
      padding:10px 12px;border-radius:14px;
      border:1px solid var(--line);
      background:rgba(10,14,30,.85);
      backdrop-filter: blur(10px);
      box-shadow:var(--shadow);
      color:var(--text);
      font-size:13px;
      display:none;
      max-width:min(820px, 92vw);
      z-index:9999;
    }
    .toast.show{display:block}

    .authWrap{min-height:100vh;display:grid;place-items:center;padding:24px}
    .authCard{width:min(980px,100%);padding:18px}

    .videoGrid{display:grid;grid-template-columns:1fr;gap:12px}
    .videoCard{
      border:1px solid var(--line);
      border-radius:16px;
      overflow:hidden;
      background:rgba(255,255,255,.03);
    }
    .videoMeta{padding:10px}
    .videoTitle{margin:0;font-weight:900;font-size:13px}
    .videoDesc{margin:6px 0 0;color:var(--muted);font-size:12px;line-height:1.5}
    iframe{width:100%;aspect-ratio:16/9;border:0;display:block}
  </style>
</head>
<body>

<div id="authView" class="authWrap" style="display:none">
  <div class="card authCard">
    <div class="logo"><span class="dotLogo"></span> AchievementChain</div>
    <p class="muted" style="margin:10px 0 0">
      Login is via MetaMask connection. If MetaMask/back-end is not ready yet, use <b>Mock Connect</b> to demo all pages.
    </p>

    <div class="grid" style="margin-top:12px">
      <div class="card block col7">
        <div class="h2">Project idea</div>
        <div class="muted">
          Schools/courses issue NFT certificates. They can‚Äôt be forged, and an employer can verify ownership quickly.
          This frontend shows: courses ‚Üí purchase ‚Üí learning (cat videos) ‚Üí progress ‚Üí claim certificate ‚Üí portfolio.
        </div>

        <div class="rowBtns">
          <button class="btnPrimary" id="connectBtnAuth">Connect MetaMask</button>
          <button id="mockConnectBtn">Mock Connect (no MetaMask)</button>
        </div>

        <div class="muted" style="margin-top:10px;font-size:12px">
          Real purchase (transfer) works only if MetaMask is installed and you confirm the transaction.
        </div>
      </div>

      <div class="card block col5">
        <div class="h2">Wallet status</div>
        <div class="pill" style="margin-top:8px">
          <span class="dot" id="authWalletDot"></span>
          <span id="authWalletText">Wallet: not connected</span>
        </div>
        <div class="pill" style="margin-top:8px">
          <span class="dot" id="authNetDot"></span>
          <span id="authNetText">Network: ‚Äî</span>
        </div>
        <div class="muted" style="margin-top:10px;font-size:12px">
          Tip: Use a test network (Sepolia/Holesky/Local).
        </div>
      </div>
    </div>
  </div>
</div>

<div id="appView" class="container" style="display:none">
  <div class="shell">
    <aside class="card sidebar">
      <div class="logo"><span class="dotLogo"></span> AchievementChain</div>
      <div class="small" style="margin-top:10px">Navigation</div>
      <nav class="nav" id="nav">
        <a href="#/courses" data-route="/courses">üìö All Courses</a>
        <a href="#/course" data-route="/course">üìñ Course Page</a>
        <a href="#/my-courses" data-route="/my-courses">‚úÖ My Courses</a>
        <a href="#/certificates" data-route="/certificates">üèÖ My Certificates</a>
        <a href="#/profile" data-route="/profile">üë§ Profile</a>
      </nav>

      <div style="margin-top:12px;padding-top:12px;border-top:1px solid var(--line)">
        <div class="small">Session</div>
        <div class="pill" style="margin-top:8px">
          <span class="dot ok"></span>
          <span id="sideWallet" class="mono">‚Äî</span>
        </div>
        <div class="rowBtns" style="margin-top:10px">
          <button id="disconnectBtn" class="btnDanger">Disconnect</button>
        </div>
        <div class="small" style="margin-top:8px">
          (Disconnect is local. To revoke access: MetaMask ‚Üí Connected sites)
        </div>
      </div>
    </aside>

    <main class="card content">
      <div class="topbar">
        <div>
          <p class="title" id="pageTitle">‚Äî</p>
          <p class="sub" id="pageSub">‚Äî</p>
        </div>
        <div style="display:flex;gap:8px;flex-wrap:wrap;align-items:center">
          <div class="pill">
            <span class="dot" id="walletDot"></span>
            <span id="walletText">Wallet: ‚Äî</span>
          </div>
          <div class="pill">
            <span class="dot" id="netDot"></span>
            <span id="netText">Network: ‚Äî</span>
          </div>
        </div>
      </div>

      <div id="page"></div>
    </main>
  </div>
</div>

<div id="toast" class="toast"></div>

<script>

const LS = {
  wallet: "ac_wallet",
  mock: "ac_mock",
  myCourses: "ac_myCourses",
  certs: "ac_certs",
  selectedCourse: "ac_selectedCourse"
};

const COURSES = [
  { id:"bc101", title:"Blockchain Basics", issuer:"Uni Course", priceEth:"0.001", payTo:"0x000000000000000000000000000000000000dEaD", tags:["Solidity","Tokens","Intro"], summary:"Blockchain fundamentals, transactions, accounts, tokens." },
  { id:"web3ui", title:"Web3 Frontend", issuer:"Open Academy", priceEth:"0.001", payTo:"0x000000000000000000000000000000000000dEaD", tags:["Ethers.js","MetaMask","UX"], summary:"Wallet connection, read/write smart contracts." },
  { id:"nftcert", title:"NFT Certificates", issuer:"SkillSchool", priceEth:"0.001", payTo:"0x000000000000000000000000000000000000dEaD", tags:["ERC-721","Metadata","Verification"], summary:"Issuing and verifying NFT certificates." }
];

function loadJSON(key, fallback){
  try { return JSON.parse(localStorage.getItem(key) || "null") ?? fallback; }
  catch { return fallback; }
}
function saveJSON(key, val){ localStorage.setItem(key, JSON.stringify(val)); }

function getMyCourses(){ return loadJSON(LS.myCourses, []); }
function setMyCourses(v){ saveJSON(LS.myCourses, v); }

function getCerts(){ return loadJSON(LS.certs, []); }
function setCerts(v){ saveJSON(LS.certs, v); }

function myCourseEntry(id){ return getMyCourses().find(x => x.id === id) || null; }
function isPurchased(id){ const x = myCourseEntry(id); return Boolean(x && x.purchasedAt); }

function clamp(n,a,b){ return Math.max(a, Math.min(b,n)); }
function percent(p){ return Math.round(p*100) + "%"; }
function shortAddr(a){ if(!a) return "‚Äî"; return a.slice(0,6) + "‚Ä¶" + a.slice(-4); }


let toastTimer = null;
function toast(msg){
  const el = document.getElementById("toast");
  el.textContent = msg;
  el.classList.add("show");
  clearTimeout(toastTimer);
  toastTimer = setTimeout(()=>el.classList.remove("show"), 2800);
}

let provider = null;
let signer = null;
let account = null;
let network = null;

const TESTNETS = { 11155111:"Sepolia", 17000:"Holesky", 31337:"Localhost (Hardhat)" };
function isTestnet(chainId){ return Boolean(TESTNETS[Number(chainId)]); }

async function initProvider(){
  if(!window.ethereum) return false;
  provider = new ethers.BrowserProvider(window.ethereum);
  return true;
}

async function connectWallet(){
  localStorage.removeItem(LS.mock);
  const ok = await initProvider();
  if(!ok){
    toast("MetaMask not found. Use Mock Connect to demo the UI.");
    return;
  }
  try{
    await window.ethereum.request({ method: "eth_requestAccounts" });
    signer = await provider.getSigner();
    account = await signer.getAddress();
    network = await provider.getNetwork();

    localStorage.setItem(LS.wallet, account);
    updateWalletUI();
    toast("Connected: " + shortAddr(account));
    showApp();
  }catch(err){
    console.error(err);
    toast("Connection rejected or failed.");
  }
}

function mockConnect(){
  localStorage.setItem(LS.mock, "1");
  account = "0xDEMO00000000000000000000000000000000DEMO";
  network = { chainId: 11155111n }; 
  provider = null;
  signer = null;
  localStorage.setItem(LS.wallet, account);
  updateWalletUI();
  toast("Mock connected. You can open all pages.");
  showApp();
}

function disconnectWallet(){
  provider = null; signer = null; account = null; network = null;
  localStorage.removeItem(LS.wallet);
  localStorage.removeItem(LS.mock);
  updateWalletUI();
  showAuth();
  toast("Disconnected (local).");
}

async function restoreWalletIfPossible(){
  const saved = localStorage.getItem(LS.wallet);
  if(!saved) return;

  if(localStorage.getItem(LS.mock) === "1"){
    account = saved;
    network = { chainId: 11155111n };
    updateWalletUI();
    showApp();
    return;
  }

  if(!window.ethereum) return;

  await initProvider();
  try{
    const accs = await window.ethereum.request({ method: "eth_accounts" });
    if(accs && accs.length){
      signer = await provider.getSigner();
      account = accs[0];
      network = await provider.getNetwork();
      localStorage.setItem(LS.wallet, account);
      updateWalletUI();
      showApp();
    }
  }catch(_){}
}

function updateWalletUI(){
  const walletText = document.getElementById("walletText");
  const walletDot = document.getElementById("walletDot");
  const netText = document.getElementById("netText");
  const netDot = document.getElementById("netDot");

  const awt = document.getElementById("authWalletText");
  const awd = document.getElementById("authWalletDot");
  const ant = document.getElementById("authNetText");
  const andd = document.getElementById("authNetDot");
  const sideWallet = document.getElementById("sideWallet");

  if(account){
    const s = shortAddr(account);
    walletText.innerHTML = `Wallet: <span class="mono">${s}</span>`;
    walletDot.className = "dot ok";
    awt.innerHTML = `Wallet: <span class="mono">${s}</span>`;
    awd.className = "dot ok";
    sideWallet.textContent = s;
  }else{
    walletText.textContent = "Wallet: ‚Äî";
    walletDot.className = "dot";
    awt.textContent = "Wallet: not connected";
    awd.className = "dot";
    sideWallet.textContent = "‚Äî";
  }

  if(network){
    const cid = Number(network.chainId);
    const name = TESTNETS[cid] || ("Chain " + cid);
    netText.innerHTML = `Network: <span class="mono">${name}</span>`;
    ant.innerHTML = `Network: <span class="mono">${name}</span>`;
    if(isTestnet(cid)){ netDot.className="dot ok"; andd.className="dot ok"; }
    else{ netDot.className="dot warn"; andd.className="dot warn"; }
  }else{
    netText.textContent = "Network: ‚Äî";
    netDot.className = "dot";
    ant.textContent = "Network: ‚Äî";
    andd.className = "dot";
  }
}

const routes = {
  "/courses": renderCourses,
  "/course": renderCourse,        
  "/my-courses": renderMyCourses,
  "/certificates": renderCertificates,
  "/profile": renderProfile
};

function setActiveNav(path){
  document.querySelectorAll("#nav a").forEach(a=>{
    a.classList.toggle("active", a.dataset.route === path);
  });
}
function setPage(title, sub){
  document.getElementById("pageTitle").textContent = title;
  document.getElementById("pageSub").textContent = sub || "";
}
function navigate(){
  const hash = location.hash || "#/courses";
  const path = hash.replace("#", "");
  const fn = routes[path] || renderCourses;
  setActiveNav(path);
  fn();
}
window.addEventListener("hashchange", navigate);

function showAuth(){
  document.getElementById("authView").style.display = "grid";
  document.getElementById("appView").style.display = "none";
}
function showApp(){
  document.getElementById("authView").style.display = "none";
  document.getElementById("appView").style.display = "block";
  if(!location.hash) location.hash = "#/courses";
  navigate();
}

async function buyCourse(courseId){
  if(!account){
    toast("Please connect a wallet first.");
    return;
  }
  const course = COURSES.find(c => c.id === courseId);
  if(!course){
    toast("Course not found.");
    return;
  }

  const isMock = localStorage.getItem(LS.mock) === "1";

  if(isMock){
    const my = getMyCourses();
    if(!myCourseEntry(courseId)){
      my.push({ id: courseId, purchasedAt: new Date().toISOString(), progress: 0, status: "in_progress", txHash: "0xMOCKTX" });
      setMyCourses(my);
    }
    toast("Mock purchase success. Course added to My Courses.");
    location.hash = "#/my-courses";
    return;
  }

  const ok = await initProvider();
  if(!ok){
    toast("MetaMask not found. Use Mock Connect.");
    return;
  }
  try{
    signer = await provider.getSigner();
    network = await provider.getNetwork();
    updateWalletUI();

    const cid = Number(network.chainId);
    if(!isTestnet(cid)){
      toast("Warning: you are not on a test network.");
    }

    const value = ethers.parseEther(course.priceEth);
    const tx = await signer.sendTransaction({ to: course.payTo, value });
    toast("Transaction sent: " + tx.hash.slice(0,10) + "‚Ä¶");
    await tx.wait();

    const my = getMyCourses();
    if(!myCourseEntry(courseId)){
      my.push({ id: courseId, purchasedAt: new Date().toISOString(), progress: 0, status: "in_progress", txHash: tx.hash });
    }else{
      const x = my.find(m => m.id === courseId);
      x.purchasedAt ||= new Date().toISOString();
      x.txHash ||= tx.hash;
      x.progress ??= 0;
      x.status ||= "in_progress";
    }
    setMyCourses(my);

    toast("Purchase successful! Course added to My Courses.");
    location.hash = "#/my-courses";
  }catch(err){
    console.error(err);
    toast("Transaction rejected or failed.");
  }
}

function addProgress(courseId, delta=0.25){
  const my = getMyCourses();
  const x = my.find(m => m.id === courseId);
  if(!x || !x.purchasedAt){
    toast("Please buy the course first.");
    return;
  }
  x.progress = clamp((x.progress ?? 0) + delta, 0, 1);
  x.status = (x.progress >= 1) ? "completed" : "in_progress";
  setMyCourses(my);
  toast("Progress: " + percent(x.progress));
  navigate();
}
function hasCertificate(courseId){
  return getCerts().some(c => c.courseId === courseId);
}
function claimCertificate(courseId){
  const course = COURSES.find(c => c.id === courseId);
  const x = myCourseEntry(courseId);
  if(!x || !x.purchasedAt){
    toast("Please buy the course first.");
    return;
  }
  if((x.progress ?? 0) < 1){
    toast("Certificate is available only after 100% progress.");
    return;
  }
  if(hasCertificate(courseId)){
    toast("Certificate already claimed.");
    return;
  }

  const certs = getCerts();
  certs.unshift({
    id: "cert-" + Date.now(),
    courseId,
    title: `${course.title} ‚Äî NFT Certificate`,
    owner: account,
    issuedAt: new Date().toISOString().slice(0,10),
    txHashMock: "0x" + Math.random().toString(16).slice(2).padEnd(64,"0")
  });
  setCerts(certs);

  toast("Certificate claimed and added to My Certificates.");
  location.hash = "#/certificates";
}

function openCourse(id){
  localStorage.setItem(LS.selectedCourse, id);
  location.hash = "#/course";
}

function renderCourses(){
  setPage("All Courses", "Browse courses. Open a course to purchase it and start learning.");

  const rows = COURSES.map(c=>{
    const purchased = isPurchased(c.id);
    const my = myCourseEntry(c.id);
    const status = purchased
      ? (my?.status === "completed" ? `<span class="tag ok">‚úÖ completed</span>` : `<span class="tag warn">‚è≥ in progress</span>`)
      : `<span class="tag bad">not purchased</span>`;

    return `
      <tr>
        <td><b>${c.title}</b><div class="small">${c.issuer}</div></td>
        <td>
          <span class="tag">${c.priceEth} ETH</span>
          <span class="tag">payTo: <span class="mono">${shortAddr(c.payTo)}</span></span>
        </td>
        <td>${c.tags.map(t=>`<span class="tag">${t}</span>`).join("")}</td>
        <td>${status}</td>
        <td>
          <div class="rowBtns">
            <button onclick="openCourse('${c.id}')">Open</button>
            ${purchased ? "" : `<button class="btnPrimary" onclick="buyCourse('${c.id}')">Buy (transfer)</button>`}
          </div>
        </td>
      </tr>
    `;
  }).join("");

  document.getElementById("page").innerHTML = `
    <div class="grid">
      <div class="card block col12">
        <table class="table">
          <thead>
            <tr><th>Course</th><th>Payment</th><th>Tags</th><th>Status</th><th>Actions</th></tr>
          </thead>
          <tbody>${rows}</tbody>
        </table>
        <div class="muted" style="margin-top:10px;font-size:12px">
          Tip: Replace <span class="mono">payTo</span> with your testnet receiver address. In Mock mode, purchase is simulated.
        </div>
      </div>
    </div>
  `;
}

function renderCourse(){
  const id = localStorage.getItem(LS.selectedCourse) || COURSES[0]?.id;
  const course = COURSES.find(c => c.id === id) || COURSES[0];

  const purchased = isPurchased(course.id);
  const my = myCourseEntry(course.id);
  const p = my?.progress ?? 0;
  const completed = p >= 1;
  const canClaim = purchased && completed && !hasCertificate(course.id);

  setPage("Course Page", "Video lessons (cats üê±), progress, purchase, and certificate.");

  document.getElementById("page").innerHTML = `
    <div class="grid">
      <div class="card block col7">
        <div class="h2">${course.title}</div>
        <div class="muted">${course.summary}</div>

        <div style="margin-top:10px">
          <span class="tag">${course.issuer}</span>
          <span class="tag">${course.priceEth} ETH</span>
          <span class="tag">payTo: <span class="mono">${shortAddr(course.payTo)}</span></span>
          ${course.tags.map(t=>`<span class="tag">${t}</span>`).join("")}
        </div>

        <div style="margin-top:12px" class="h2">Purchase & Progress</div>
        <div class="muted">
          ${purchased ? `<span class="tag ok">purchased</span>` : `<span class="tag bad">not purchased</span>`}
          ${completed ? `<span class="tag ok">completed</span>` : (purchased ? `<span class="tag warn">in progress</span>` : "")}
        </div>

        <div style="margin-top:10px">
          <div class="bar"><div style="width:${Math.round(p*100)}%"></div></div>
          <div class="small" style="margin-top:6px">Progress: ${percent(p)}</div>
        </div>

        <div class="rowBtns">
          ${purchased ? "" : `<button class="btnPrimary" onclick="buyCourse('${course.id}')">Buy course (transfer)</button>`}
          ${purchased ? `<button class="btnOk" onclick="addProgress('${course.id}', 0.25)">Mark lesson done (+25%)</button>` : ""}
          ${canClaim ? `<button class="btnPrimary" onclick="claimCertificate('${course.id}')">Claim certificate</button>` : ""}
          <button onclick="location.hash='#/courses'">Back to catalog</button>
        </div>

        <div class="muted" style="margin-top:10px;font-size:12px">
          Note: Videos are embedded. If YouTube is blocked, replace the iframe links with your own hosted videos.
        </div>
      </div>

      <div class="card block col5">
        <div class="h2">Cat Lessons </div>

        <div class="videoGrid">
          <div class="videoCard">
            <iframe
              src="https://www.youtube-nocookie.com/embed/J---aiyznGQ"
              title="Cat Lesson 1"
              allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
              allowfullscreen></iframe>
            <div class="videoMeta">
              <p class="videoTitle">Lesson 1 ‚Äî Attention & Focus (with cats)</p>
              <p class="videoDesc">Warm-up: focus your attention while the cat does‚Ä¶ cat things.</p>
            </div>
          </div>

          <div class="videoCard">
            <iframe
              src="https://www.youtube-nocookie.com/embed/tntOCGkgt98"
              title="Cat Lesson 2"
              allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
              allowfullscreen></iframe>
            <div class="videoMeta">
              <p class="videoTitle">Lesson 2 ‚Äî ‚ÄúProof of Work‚Äù explained by a cat (kind of)</p>
              <p class="videoDesc">You watch a cat; we pretend it‚Äôs blockchain education. Everybody wins.</p>
            </div>
          </div>

          <div class="videoCard">
            <iframe
              src="https://www.youtube-nocookie.com/embed/hY7m5jjJ9mM"
              title="Cat Lesson 3"
              allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
              allowfullscreen></iframe>
            <div class="videoMeta">
              <p class="videoTitle">Lesson 3 ‚Äî Final Review (cats + calm)</p>
              <p class="videoDesc">After finishing all lessons and reaching 100%, claim your certificate.</p>
            </div>
          </div>
        </div>

        <div class="muted" style="margin-top:10px;font-size:12px">
          Tip: Use the ‚ÄúMark lesson done (+25%)‚Äù button after each video to simulate learning progress.
        </div>
      </div>
    </div>
  `;
}

function renderMyCourses(){
  setPage("My Courses", "Purchased courses + progress. Reach 100% to claim a certificate.");

  const my = getMyCourses();
  if(my.length === 0){
    document.getElementById("page").innerHTML = `
      <div class="card block">
        <div class="h2">No courses yet</div>
        <div class="muted">Go to All Courses and purchase a course.</div>
        <div class="rowBtns"><button class="btnPrimary" onclick="location.hash='#/courses'">Open catalog</button></div>
      </div>
    `;
    return;
  }

  const rows = my.map(x=>{
    const c = COURSES.find(k => k.id === x.id);
    const p = x.progress ?? 0;
    const status = (p >= 1) ? `<span class="tag ok">‚úÖ completed</span>` : `<span class="tag warn">‚è≥ ${percent(p)}</span>`;
    const canClaim = p >= 1 && !hasCertificate(x.id);

    return `
      <tr>
        <td><b>${c?.title || x.id}</b><div class="small">${c?.issuer || ""}</div></td>
        <td>
          <div class="bar"><div style="width:${Math.round(p*100)}%"></div></div>
          <div class="small" style="margin-top:6px">${percent(p)}</div>
        </td>
        <td>${status}</td>
        <td><span class="tag">buy tx: <span class="mono">${(x.txHash||"‚Äî").slice(0,10)}‚Ä¶</span></span></td>
        <td>
          <div class="rowBtns">
            <button onclick="openCourse('${x.id}')">Open</button>
            <button class="btnOk" onclick="addProgress('${x.id}', 0.25)">+25%</button>
            ${canClaim ? `<button class="btnPrimary" onclick="claimCertificate('${x.id}')">Claim certificate</button>` : ""}
          </div>
        </td>
      </tr>
    `;
  }).join("");

  document.getElementById("page").innerHTML = `
    <div class="grid">
      <div class="card block col12">
        <table class="table">
          <thead>
            <tr><th>Course</th><th>Progress</th><th>Status</th><th>Payment</th><th>Actions</th></tr>
          </thead>
          <tbody>${rows}</tbody>
        </table>
      </div>
    </div>
  `;
}

function renderCertificates(){
  setPage("My Certificates", "Certificates you claimed after completing courses (demo).");

  const certs = getCerts();
  if(certs.length === 0){
    document.getElementById("page").innerHTML = `
      <div class="card block">
        <div class="h2">No certificates yet</div>
        <div class="muted">Buy a course ‚Üí reach 100% progress ‚Üí claim certificate.</div>
        <div class="rowBtns"><button class="btnPrimary" onclick="location.hash='#/my-courses'">My Courses</button></div>
      </div>
    `;
    return;
  }

  const rows = certs.map(c=>{
    const course = COURSES.find(k => k.id === c.courseId);
    return `
      <tr>
        <td><b>${c.title}</b><div class="small">course: ${course?.title || c.courseId}</div></td>
        <td>
          <span class="tag ok">owner: <span class="mono">${shortAddr(c.owner)}</span></span>
          <span class="tag">date: ${c.issuedAt}</span>
        </td>
        <td><span class="tag">proof (demo): <span class="mono">${c.txHashMock.slice(0,10)}‚Ä¶</span></span></td>
      </tr>
    `;
  }).join("");

  document.getElementById("page").innerHTML = `
    <div class="grid">
      <div class="card block col12">
        <table class="table">
          <thead><tr><th>Certificate</th><th>Owner</th><th>Proof</th></tr></thead>
          <tbody>${rows}</tbody>
        </table>
      </div>
    </div>
  `;
}

function renderProfile(){
  setPage("Profile", "Blockchain CV: wallet + courses + certificates.");

  const my = getMyCourses();
  const certs = getCerts();
  const completed = my.filter(x => (x.progress ?? 0) >= 1).length;
  const mock = localStorage.getItem(LS.mock) === "1";

  document.getElementById("page").innerHTML = `
    <div class="grid">
      <div class="card block col7">
        <div class="h2">Wallet</div>
        <div class="muted">
          <b>Address:</b> <span class="mono">${account || "‚Äî"}</span><br/>
          <b>Network:</b> <span class="mono">${network ? (TESTNETS[Number(network.chainId)] || ("Chain "+Number(network.chainId))) : "‚Äî"}</span><br/>
          <b>Mode:</b> ${mock ? `<span class="tag warn">Mock</span>` : `<span class="tag ok">Real</span>`}
        </div>

        <div class="rowBtns">
          <button class="btnPrimary" onclick="location.hash='#/courses'">Browse courses</button>
          <button onclick="location.hash='#/certificates'">View certificates</button>
          <button onclick="location.hash='#/course'">Open course page</button>
        </div>

        <div class="muted" style="margin-top:10px;font-size:12px">
          Employer can verify certificates here (real version: on-chain verification).
        </div>
      </div>

      <div class="card block col5">
        <div class="h2">Summary</div>
        <div class="tag">purchased: <b>${my.length}</b></div>
        <div class="tag ok">completed: <b>${completed}</b></div>
        <div class="tag warn">certificates: <b>${certs.length}</b></div>
      </div>

      <div class="card block col12">
        <div class="h2">How to open pages</div>
        <div class="muted">
          Use left navigation or URL hash:
          <span class="mono">#/courses</span>,
          <span class="mono">#/course</span>,
          <span class="mono">#/my-courses</span>,
          <span class="mono">#/certificates</span>,
          <span class="mono">#/profile</span>
        </div>
      </div>
    </div>
  `;
}

document.getElementById("connectBtnAuth").addEventListener("click", connectWallet);
document.getElementById("mockConnectBtn").addEventListener("click", mockConnect);
document.getElementById("disconnectBtn").addEventListener("click", disconnectWallet);

(function boot(){
  updateWalletUI();
  showAuth();
  restoreWalletIfPossible();
})();
</script>
</body>
</html>
